<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foe Foundry Generator</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #1b1b1b;
            color: #eee;
        }

        .monster-card {
            background-color: #2a2a2a;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .popup-tray {
            display: none;
            position: absolute;
            background: #1b1b1b;
            border: 1px solid #555;
            padding: 0.5rem;
            border-radius: 6px;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            min-width: 160px;
        }

        .monster-ability[data-power-id] {
            margin: 1rem 0;
        }

        @keyframes flash {
            0% {
                background-color: #444;
            }

            50% {
                background-color: #888;
            }

            100% {
                background-color: transparent;
            }
        }

        .power-highlight {
            animation: flash 1.5s ease-in-out;
        }
    </style>
</head>

<body>

    <div class="container-fluid py-3">
        <div class="row">
            <!-- Monster Card Panel -->
            <div class="col-md-5 position-relative">
                <div class="monster-card p-3">
                    <!-- Monster Art -->
                    <div class="text-center mb-3">
                        <img src="https://via.placeholder.com/300x200" alt="Skeleton Art"
                            class="img-fluid rounded shadow" />
                    </div>

                    <!-- Monster Name and Info -->
                    <h2 class="text-center">Skeleton</h2>
                    <p class="text-center text-muted mb-1">Undead â€¢ Swamp</p>
                    <p class="text-center fw-semibold">CR 3</p>

                    <!-- Tags -->
                    <div class="d-flex flex-wrap justify-content-center gap-2 mb-3">
                        <span class="badge bg-secondary">Undead</span>
                        <span class="badge bg-success">Swamp</span>
                        <span class="badge bg-warning text-dark">Elite</span>
                    </div>

                    <hr class="border-secondary" />

                    <!-- Power Slot: Dark Gift -->
                    <div class="mb-3 position-relative">
                        <label class="form-label d-block">Dark Gift:</label>
                        <button class="btn btn-outline-light w-100 text-start"
                            onclick="openPopup(this, 'dark-gift', 'Grave Touch')">
                            ðŸ’€ Grave Touch
                        </button>

                        <!-- Popup -->
                        <div class="popup-tray mt-2" id="popup-dark-gift">
                            <button class="btn btn-sm btn-dark w-100 mb-1"
                                onclick="selectPower('dark-gift', 'Grave Touch')">Grave Touch</button>
                            <button class="btn btn-sm btn-dark w-100 mb-1"
                                onclick="selectPower('dark-gift', 'Bone Lance')">Bone Lance</button>
                            <button class="btn btn-sm btn-outline-light w-100" onclick="rollRandom('dark-gift')">ðŸŽ²
                                Random</button>
                        </div>
                    </div>

                    <!-- More power slots can go here -->
                </div>
            </div>

            <!-- Statblock Panel -->
            <div class="col-md-7">
                <h2 class="mb-4">Statblock</h2>
                <div class="monster-ability" data-power-id="power-grave-touch">
                    <strong>Grave Touch.</strong> The skeleton's attacks deal an extra 1d6 necrotic damage.
                </div>
                <div class="monster-ability" data-power-id="power-bone-lance">
                    <strong>Bone Lance.</strong> The skeleton hurls a sharpened rib bone up to 60 ft.
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="position-fixed bottom-0 start-50 translate-middle-x mb-4 z-3">
        <div id="toast" class="toast text-bg-dark align-items-center border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body" id="toast-body">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const toastEl = document.getElementById("toast");
        const toastBody = document.getElementById("toast-body");
        const toast = new bootstrap.Toast(toastEl);

        function openPopup(button, slotId, currentPower) {
            const popup = document.getElementById('popup-' + slotId);
            const allPopups = document.querySelectorAll('.popup-tray');
            allPopups.forEach(p => p.style.display = 'none');

            const rect = button.getBoundingClientRect();
            popup.style.top = `${button.offsetTop + button.offsetHeight + 4}px`;
            popup.style.left = `${button.offsetLeft}px`;
            popup.style.display = 'block';
        }

        function selectPower(slotId, powerName) {
            showToast(`${capitalize(slotId.replace('-', ' '))} changed to ${powerName}`, () => {
                highlightPower(powerName);
            });
        }

        function rollRandom(slotId) {
            const options = ['Grave Touch', 'Bone Lance'];
            const random = options[Math.floor(Math.random() * options.length)];
            selectPower(slotId, random);
        }

        function showToast(message, onFinish) {
            let countdown = 3;
            toastBody.innerText = `${message}. Switching in ${countdown}...`;
            toast.show();

            const interval = setInterval(() => {
                countdown--;
                toastBody.innerText = `${message}. Switching in ${countdown}...`;
                if (countdown <= 0) {
                    clearInterval(interval);
                    toast.hide();
                    if (onFinish) onFinish();
                }
            }, 1000);
        }

        function highlightPower(powerName) {
            const powerId = 'power-' + powerName.toLowerCase().replace(/\s+/g, '-');
            const el = document.querySelector(`[data-power-id="${powerId}"]`);
            if (el) {
                el.classList.add('power-highlight');
                setTimeout(() => el.classList.remove('power-highlight'), 2000);
            }
        }

        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Close popup when clicking outside
        document.addEventListener("click", function (event) {
            const isInside = event.target.closest(".popup-tray") || event.target.closest(".btn");
            if (!isInside) {
                document.querySelectorAll('.popup-tray').forEach(p => p.style.display = 'none');
            }
        });
    </script>

</body>

</html>