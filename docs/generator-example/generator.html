<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foe Foundry Monster Generator</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="generator.css" />
</head>

<body>

    <div class="container-fluid py-4">
        <div class="row g-4">
            <!-- Monster Card Panel -->
            <div class="col-md-5 position-relative">
                <div class="monster-card p-3">

                    <!-- Meta Info Block -->
                    <div class="mb-3 p-3 border border-secondary rounded bg-dark">
                        <h2 class="text-center mb-2">Skeleton</h2>
                        <p class="text-center mb-1">Undead â€¢ Swamp</p>
                        <p class="text-center fw-semibold">CR 3</p>
                        <div class="d-flex flex-wrap justify-content-center gap-2 mt-2">
                            <span class="badge bg-secondary">Undead</span>
                            <span class="badge bg-success">Swamp</span>
                            <span class="badge bg-warning text-dark">Elite</span>
                        </div>
                    </div>

                    <!-- Art Section -->
                    <div class="mb-3 border border-secondary rounded bg-light monster-card-image-container">
                        <img src="../img/monsters/skeleton.webp" alt="Skeleton Art" class="card-image contain blend" />
                    </div>

                    <!-- Power Slot Block -->
                    <div class="mb-3 p-3 border border-secondary rounded bg-dark position-relative">
                        <label class="form-label fw-bold">Skeletal Boon</label>
                        <p class="fst-italic">Rattling bones and grinning skulls</p>
                        <button class="btn btn-outline-light w-100 text-start">
                            Skeletal Reconstruction
                        </button>

                        <div class="popup-tray mt-2">
                            <button class="btn btn-sm btn-dark w-100 mb-1">Bone Shards</button>
                            <button class="btn btn-sm btn-dark w-100 mb-1">Bone Spear</button>
                            <button class="btn btn-sm btn-dark w-100 mb-1">Bone Storm</button>
                            <button class="btn btn-sm btn-dark w-100 mb-1">Bone Wall</button>
                            <button class="btn btn-sm btn-dark w-100 mb-1">Loathsome Rattle</button>
                            <button class="btn btn-sm btn-dark w-100 mb-1">Skeletal Reconstruction</button>
                            <button class="btn btn-sm btn-outline-light w-100">ðŸŽ² Random</button>
                        </div>
                    </div>

                    <!-- Add additional power blocks here if needed -->

                </div>
            </div>

            <!-- Statblock Panel -->
            <div class="col-md-7">
                <h2 class="mb-4">Statblock</h2>
                <div class="monster-ability" data-power-id="power-grave-touch">
                    <strong>Grave Touch.</strong> The skeletonâ€™s attacks deal an extra 1d6 necrotic damage.
                </div>
                <div class="monster-ability" data-power-id="power-bone-lance">
                    <strong>Bone Lance.</strong> The skeleton hurls a sharpened rib bone up to 60 ft.
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="position-fixed bottom-0 start-50 translate-middle-x mb-4 z-3">
        <div id="toast" class="toast text-bg-dark align-items-center border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body" id="toast-body">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const toastEl = document.getElementById("toast");
        const toastBody = document.getElementById("toast-body");
        const toast = new bootstrap.Toast(toastEl);

        function openPopup(button, slotId, currentPower) {
            const popup = document.getElementById('popup-' + slotId);
            const allPopups = document.querySelectorAll('.popup-tray');
            allPopups.forEach(p => p.style.display = 'none');

            const rect = button.getBoundingClientRect();
            const parent = button.offsetParent;
            popup.style.top = `${button.offsetTop + button.offsetHeight + 4}px`;
            popup.style.left = `${button.offsetLeft}px`;
            popup.style.display = 'block';
        }

        function selectPower(slotId, powerName) {
            showToast(`${capitalize(slotId.replace('-', ' '))} changed to ${powerName}`, () => {
                highlightPower(powerName);
            });
        }

        function rollRandom(slotId) {
            const options = ['Grave Touch', 'Bone Lance'];
            const random = options[Math.floor(Math.random() * options.length)];
            selectPower(slotId, random);
        }

        function showToast(message, onFinish) {
            let countdown = 3;
            toastBody.innerText = `${message}. Switching in ${countdown}...`;
            toast.show();

            const interval = setInterval(() => {
                countdown--;
                toastBody.innerText = `${message}. Switching in ${countdown}...`;
                if (countdown <= 0) {
                    clearInterval(interval);
                    toast.hide();
                    if (onFinish) onFinish();
                }
            }, 1000);
        }

        function highlightPower(powerName) {
            const powerId = 'power-' + powerName.toLowerCase().replace(/\s+/g, '-');
            const el = document.querySelector(`[data-power-id="${powerId}"]`);
            if (el) {
                el.classList.add('power-highlight');
                setTimeout(() => el.classList.remove('power-highlight'), 2000);
            }
        }

        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Dismiss popup on outside click
        document.addEventListener("click", function (event) {
            const isInside = event.target.closest(".popup-tray") || event.target.closest(".btn");
            if (!isInside) {
                document.querySelectorAll('.popup-tray').forEach(p => p.style.display = 'none');
            }
        });
    </script>

</body>

</html>