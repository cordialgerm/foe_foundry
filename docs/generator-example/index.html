<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foe Foundry Monster Generator</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="generator.css" />
    <!-- <link rel="stylesheet" href="raty.css" /> -->
    <link rel="stylesheet" href="../css/site.css" />
</head>


<body>
    <div class="container-fluid py-4">
        <div class="row g-4">
            <!-- Monster Card Panel -->
            <div class="col-md-5 position-relative">
                <monster-card monster-key="skeleton"></monster-card>
                <monster-card monster-key="basilisk"></monster-card>
                <monster-card monster-key="gelatinous-cube"></monster-card>
                <monster-card monster-key="knight"></monster-card>
                <monster-card monster-key="frost-giant"></monster-card>
            </div>
            <!-- Statblock Panel -->
            <div class="col-md-7">
                <div id="statblock-holder"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="src/main.ts"></script>
    <script>

        const statblockHolder = document.getElementById('statblock-holder');
        const monsters = initializeMockMonsterStore();

        document.querySelectorAll('monster-card').forEach(card => {
            card.addEventListener('monster-changed', async (event) => {
                const monsterCard = event.detail.monsterCard;
                if (!monsterCard) return;

                statblockHolder.innerHTML = ''; // Clear previous statblock

                // Get selected powers
                const selectedPowers = monsterCard.getSelectedPowers().map(p => p?.key).filter(Boolean);

                const request = {
                    monsterKey: monsterCard.monsterKey,
                    powers: selectedPowers,
                    hpMultiplier: monsterCard.hpMultiplier,
                    damageMultiplier: monsterCard.damageMultiplier,
                }

                // Highlight changed powers if present in event.detail.power
                let change = null;
                if (event.detail.power && event.detail.power.key) {
                    change = {
                        type: 'power-changed',
                        power: event.detail.power

                    }
                }
                else if (event.detail.changeType === 'damage-changed') {
                    change = {
                        type: 'damage-changed',
                    }
                }
                else if (event.detail.changeType === 'hp-changed') {
                    change = {
                        type: 'hp-changed',
                    }
                }

                const statblockElement = await monsters.getStatblock(request, change);

                statblockHolder.appendChild(statblockElement);
            });
        });
    </script>
</body>

</html>