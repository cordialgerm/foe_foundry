<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foe Foundry Monster Generator</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="generator.css" />
    <link rel="stylesheet" href="raty.css" />
</head>


<body>
    <div class="container-fluid py-4">
        <div class="row g-4">
            <!-- Monster Card Panel -->
            <div class="col-md-5 position-relative">
                <monster-card monster-key="skeleton"></monster-card>

                <div class="my-5">

                </div>
                <monster-card monster-key="basilisk"></monster-card>
                <monster-card monster-key="gelatinous-cube"></monster-card>
                <monster-card monster-key="knight"></monster-card>
                <monster-card monster-key="frost-giant"></monster-card>
            </div>
            <!-- Statblock Panel -->
            <div class="col-md-7">
                <h2>Event Log</h2>
                <div id="statblock-holder"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="src/main.ts"></script>
    <script>

        const statblockHolder = document.getElementById('statblock-holder');

        document.querySelectorAll('monster-card').forEach(card => {
            card.addEventListener('monster-changed', async (event) => {
                const monsterCard = event.detail.monsterCard;
                if (!monsterCard) return;

                // Get selected powers
                const selectedPowers = monsterCard.getSelectedPowers().map(p => p?.key).filter(Boolean);
                const monsterKey = monsterCard.monsterKey;

                // Build request payload
                const payload = {
                    monster_key: monsterKey,
                    powers: selectedPowers.length ? selectedPowers : undefined
                };

                // POST to API
                try {
                    const response = await fetch('https://foefoundry.com/api/v1/monsters/generate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const statblock_html = result["statblock_html"];

                    statblockHolder.innerHTML = statblock_html;
                } catch (err) {
                    statblockHolder.innerHTML = `<div class="alert alert-danger">API Error: ${err}</div>`;
                }
            });
        });
    </script>
</body>

</html>